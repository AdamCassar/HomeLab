---
- hosts: all
  vars_files:
    - /etc/ansible/vault.yaml
  tasks:
    - group:
        name: ansible
        gid: 1000
        state: present
    - user:
        name: ansible
        uid: 1000
        group: ansible
        groups: cdrom,floppy,audio,dip,video,plugdev,netdev
        password: "{{ ansible_password_crypted }}"
        shell: /bin/bash
        state: present
    - apt:
        update_cache: yes
        name:
          - curl
          - sudo
        state: present
    - copy:
        content: "ansible	ALL = (ALL) NOPASSWD:ALL"
        dest: /etc/sudoers.d/ansible
    - ansible.posix.authorized_key:
        user: ansible
        key: https://github.com/iamwillbar.keys
        exclusive: yes
        state: present
